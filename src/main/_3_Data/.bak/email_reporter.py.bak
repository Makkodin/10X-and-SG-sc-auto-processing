import os
import zipfile
import pandas as pd
from typing import List, Optional, Dict
import configparser
from zeep import Client, Settings
from zeep.transports import Transport
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.base import MIMEBase
from email import encoders
import base64
from requests import Session
from requests.auth import HTTPBasicAuth
import urllib3
from urllib3.exceptions import InsecureRequestWarning

# –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ SSL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
urllib3.disable_warnings(InsecureRequestWarning)

class EmailReporter:
    def __init__(self, exchange_config: Dict[str, str]):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è email —Ä–µ–ø–æ—Ä—Ç–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SOAP API —á–µ—Ä–µ–∑ WSDL
        :param exchange_config: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Exchange –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è
        """
        self.exchange_config = exchange_config
        self.client = None
        self.session = None
    
    def create_soap_client(self):
        """
        –°–æ–∑–¥–∞–µ—Ç SOAP –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Exchange Web Services
        """
        try:
            # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
            self.session = Session()
            self.session.auth = HTTPBasicAuth(
                self.exchange_config['sender_email'],
                self.exchange_config['sender_password']
            )
            self.session.verify = False  # –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SSL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
            settings = Settings(
                strict=False,
                xml_huge_tree=True,
                extra_http_headers={
                    'Content-Type': 'text/xml; charset=utf-8',
                    'User-Agent': 'Python-SOAP-Client'
                }
            )
            
            transport = Transport(session=self.session)
            
            # –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç –¥–ª—è WSDL
            self.client = Client(
                wsdl=self.exchange_config['wsdl_url'],
                settings=settings,
                transport=transport
            )
            
            print("‚úÖ SOAP –∫–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω")
            return True
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è SOAP –∫–ª–∏–µ–Ω—Ç–∞: {e}")
            return False
    
    def create_archive(self, source_dir: str, archive_name: str) -> str:
        """
        –°–æ–∑–¥–∞–µ—Ç ZIP –∞—Ä—Ö–∏–≤ –∏–∑ –≤—Å–µ—Ö HTML –∏ PNG —Ñ–∞–π–ª–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        """
        archive_path = os.path.join(source_dir, archive_name)
        
        with zipfile.ZipFile(archive_path, 'w', zipfile.ZIP_DEFLATED) as zipf:
            for root, _, files in os.walk(source_dir):
                for file in files:
                    if file.endswith(('.html', '.png', '.csv')):
                        file_path = os.path.join(root, file)
                        arcname = os.path.relpath(file_path, source_dir)
                        zipf.write(file_path, arcname)
        
        return archive_path
    
    def format_statistics_table(self, df: pd.DataFrame) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
        """
        formatted_df = df.copy()

        for col in formatted_df.columns:
            if formatted_df[col].dtype in ['float64', 'int64']:
                # –î–ª—è –∫–æ–ª–æ–Ω–∫–∏ sample_id —É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—ã–µ
                if col.lower() == 'sample_id':
                    formatted_df[col] = formatted_df[col].apply(lambda x: f"{x:.0f}" if pd.notna(x) else "N/A")
                # –î–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
                elif any('percent' in col.lower() or '%' in col.lower() for col in formatted_df.columns):
                    formatted_df[col] = formatted_df[col].apply(lambda x: f"{x:.1f}%" if pd.notna(x) else "N/A")
                # –î–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª (–∫—Ä–æ–º–µ sample_id)
                elif formatted_df[col].max() > 1000:
                    formatted_df[col] = formatted_df[col].apply(lambda x: f"{x:,.0f}" if pd.notna(x) else "N/A")
                # –î–ª—è –æ–±—ã—á–Ω—ã—Ö —á–∏—Å–µ–ª
                else:
                    formatted_df[col] = formatted_df[col].apply(lambda x: f"{x:.0f}" if pd.notna(x) else "N/A")

        html_table = formatted_df.to_html(
            index=False, 
            classes='statistics-table',
            border=1,
            justify='left'
        )
        return html_table
    
    def create_email_body(self, flowcell: str, ceph_paths: List[str], 
                         statistics_csv_path: str) -> str:
        """
        –°–æ–∑–¥–∞–µ—Ç —Ç–µ–ª–æ email —Å —Ç–∞–±–ª–∏—Ü–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        """
        try:
            df = pd.read_csv(statistics_csv_path)
            stats_table = self.format_statistics_table(df)
        except Exception as e:
            stats_table = f"<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: {e}</p>"
        
        email_body = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <style>
                body {{ font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; color: #333; }}
                .container {{ max-width: 1200px; margin: 0 auto; }}
                .header {{ background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px; }}
                .statistics-table {{ width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }}
                .statistics-table th {{ background-color: #e9ecef; padding: 12px; text-align: left; font-weight: bold; border: 1px solid #dee2e6; }}
                .statistics-table td {{ padding: 10px; border: 1px solid #dee2e6; }}
                .statistics-table tr:nth-child(even) {{ background-color: #f8f9fa; }}
                .statistics-table tr:hover {{ background-color: #e9ecef; }}
                .info-box {{ background-color: #e7f3ff; border-left: 4px solid #007bff; padding: 15px; margin: 15px 0; border-radius: 3px; }}
                .footer {{ margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #6c757d; font-size: 12px; }}
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header"><h2>–û—Ç—á–µ—Ç –æ–± –æ–±—Ä–∞–±–æ—Ç–∫–µ —è—á–µ–π–∫–∏ {flowcell}</h2></div>
                <p>–î–æ–±—Ä—ã–π –¥–µ–Ω—å,</p>
                <div class="info-box">
                    <p>–û–±—Ä–∞–±–æ—Ç–∫–∞ —è—á–µ–π–∫–∏ <strong>{flowcell}</strong> —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.</p>
                    <p><strong>–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:</strong><br>
                    {', '.join([f'{path}{flowcell}' for path in ceph_paths])}</p>
                </div>
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —è—á–µ–π–∫–µ:</h3>
                {stats_table}
                <div class="footer">
                    <p>–≠—Ç–æ –ø–∏—Å—å–º–æ –±—ã–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –Ω–µ–≥–æ.</p>
                    <p>–° —É–≤–∞–∂–µ–Ω–∏–µ–º,<br>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                </div>
            </div>
        </body>
        </html>
        """
        
        return email_body
    
    def send_email_soap(self, recipient_emails: List[str], subject: str, 
                       body: str, attachment_path: Optional[str] = None) -> bool:
        """
        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —á–µ—Ä–µ–∑ SOAP API –∏—Å–ø–æ–ª—å–∑—É—è WSDL
        """
        try:
            if not self.client:
                if not self.create_soap_client():
                    return False
            
            # –ß–∏—Ç–∞–µ–º –≤–ª–æ–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            attachment_data = None
            attachment_name = None
            if attachment_path and os.path.exists(attachment_path):
                with open(attachment_path, 'rb') as f:
                    attachment_data = base64.b64encode(f.read()).decode('utf-8')
                attachment_name = os.path.basename(attachment_path)
            
            # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è SOAP –∑–∞–ø—Ä–æ—Å–∞
            soap_request = {
                'From': {'Address': self.exchange_config['sender_email']},
                'ToRecipients': [{'Mailbox': {'EmailAddress': email}} for email in recipient_emails],
                'Subject': subject,
                'Body': {
                    'BodyType': 'HTML',
                    '_value_1': body
                }
            }
            
            # –î–æ–±–∞–≤–ª—è–µ–º –≤–ª–æ–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            if attachment_data:
                soap_request['Attachments'] = {
                    'FileAttachment': {
                        'Name': attachment_name,
                        'Content': attachment_data,
                        'ContentType': 'application/zip'
                    }
                }
            
            # –í—ã–∑—ã–≤–∞–µ–º SOAP –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞
            # –ú–µ—Ç–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–∞—à–µ–≥–æ WSDL
            try:
                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–µ—Ç–æ–¥
                response = self.client.service.CreateItem(
                    Message=soap_request
                )
                print("‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SOAP API")
                return True
                
            except AttributeError:
                # –ï—Å–ª–∏ –º–µ—Ç–æ–¥ CreateItem –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–ø—Ä–æ–±—É–µ–º SendEmail
                try:
                    response = self.client.service.SendEmail(**soap_request)
                    print("‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SOAP API")
                    return True
                except Exception as e:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞ SOAP –º–µ—Ç–æ–¥–∞ SendEmail: {e}")
                    return False
                    
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ SOAP: {e}")
            return False
    
    def send_email_smtp_fallback(self, recipient_emails: List[str], subject: str, 
                               body: str, attachment_path: Optional[str] = None) -> bool:
        """
        –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ SMTP –µ—Å–ª–∏ SOAP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
        """
        try:
            msg = MIMEMultipart()
            msg['From'] = self.exchange_config['sender_email']
            msg['To'] = ', '.join(recipient_emails)
            msg['Subject'] = subject
            
            msg.attach(MIMEText(body, 'html'))
            
            if attachment_path and os.path.exists(attachment_path):
                with open(attachment_path, 'rb') as attachment:
                    part = MIMEBase('application', 'octet-stream')
                    part.set_payload(attachment.read())
                    encoders.encode_base64(part)
                    part.add_header(
                        'Content-Disposition',
                        f'attachment; filename="{os.path.basename(attachment_path)}"'
                    )
                    msg.attach(part)
            
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º SMTP –∫–∞–∫ fallback
            import smtplib
            with smtplib.SMTP(self.exchange_config.get('smtp_server', 'mail2.cspfmba.ru'), 
                             self.exchange_config.get('smtp_port', 587)) as server:
                server.starttls()
                server.login(self.exchange_config['sender_email'], 
                            self.exchange_config['sender_password'])
                server.sendmail(self.exchange_config['sender_email'], 
                               recipient_emails, msg.as_string())
            
            print("‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ SMTP (fallback)")
            return True
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ SMTP: {e}")
            return False

def load_exchange_config(config_path: str, sender_email: str, sender_password: str) -> Dict[str, str]:
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Exchange –∏–∑ —Ñ–∞–π–ª–∞, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—è email –∏ –ø–∞—Ä–æ–ª—å
    """
    config = configparser.ConfigParser()
    
    try:
        config.read(config_path)
        
        if 'EXCHANGE' not in config:
            raise ValueError("–°–µ–∫—Ü–∏—è [EXCHANGE] –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        
        return {
            'sender_email': sender_email,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π email
            'sender_password': sender_password,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
            'wsdl_url': config['EXCHANGE'].get('wsdl_url', 'https://mail2.cspfmba.ru:444/EWS/Services.wsdl'),
            'smtp_server': config['EXCHANGE'].get('smtp_server', 'mail2.cspfmba.ru'),
            'smtp_port': config['EXCHANGE'].get('smtp_port', '587'),
            'ews_url': config['EXCHANGE'].get('ews_url', 'https://mail2.cspfmba.ru:444/EWS/Exchange.asmx')
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: {e}")
        return {}

def load_recipients_config(config_path: str) -> List[str]:
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    """
    config = configparser.ConfigParser()
    
    try:
        config.read(config_path)
        
        if 'RECIPIENTS' not in config:
            raise ValueError("–°–µ–∫—Ü–∏—è [RECIPIENTS] –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        
        emails_str = config['RECIPIENTS'].get('emails', '')
        emails = [email.strip() for email in emails_str.split(',') if email.strip()]
        
        return emails
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π: {e}")
        return []

def archive_and_send_report(sum_path: str, flowcell: str, ceph_paths: List[str],
                           config_path: str, sender_email: str, sender_password: str,
                           dry_run: bool = False) -> bool:
    """
    –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞
    """
    try:
        if not os.path.exists(sum_path):
            print(f"‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è {sum_path} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
            return False
        
        stats_csv_path = os.path.join(sum_path, f"{flowcell}_statistics_summary.csv")
        if not os.path.exists(stats_csv_path):
            print(f"‚ùå –§–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω: {stats_csv_path}")
            return False
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –ø–µ—Ä–µ–¥–∞–≤–∞—è email –∏ –ø–∞—Ä–æ–ª—å –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        exchange_config = load_exchange_config(config_path, sender_email, sender_password)
        if not exchange_config:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é")
            return False
        
        recipient_emails = load_recipients_config(config_path)
        if not recipient_emails:
            print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π")
            return False
        
        if dry_run:
            print("üî¨ –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú")
            print(f"üìÅ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {sum_path}")
            print(f"üî¨ Flowcell: {flowcell}")
            print(f"üìß –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å: {sender_email}")
            print(f"üìß –ü–æ–ª—É—á–∞—Ç–µ–ª–∏: {recipient_emails}")
            return True
        
        reporter = EmailReporter(exchange_config)
        
        # –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
        archive_name = f"{flowcell}_reports.zip"
        print(f"üïí –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ {archive_name}...")
        archive_path = reporter.create_archive(sum_path, archive_name)
        print(f"‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: {archive_path}")
        
        # –°–æ–∑–¥–∞–µ–º —Ç–µ–ª–æ –ø–∏—Å—å–º–∞
        print("üïí –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –ø–∏—Å—å–º–∞...")
        email_body = reporter.create_email_body(flowcell, ceph_paths, stats_csv_path)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º email
        subject = f"–û–±—Ä–∞–±–æ—Ç–∫–∞ —è—á–µ–π–∫–∏ {flowcell} –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
        print(f"üïí –û—Ç–ø—Ä–∞–≤–∫–∞ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è–º: {recipient_emails}...")
        
        # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ SOAP
        success = reporter.send_email_soap(
            recipient_emails=recipient_emails,
            subject=subject,
            body=email_body,
            attachment_path=archive_path
        )
        
        # –ï—Å–ª–∏ SOAP –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º SMTP
        if not success:
            print("‚ö†Ô∏è SOAP –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø—Ä–æ–±—É–µ–º SMTP...")
            success = reporter.send_email_smtp_fallback(
                recipient_emails=recipient_emails,
                subject=subject,
                body=email_body,
                attachment_path=archive_path
            )
        
        return success
            
    except Exception as e:
        print(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        return False